<!DOCTYPE html>
<html>
<head>
  <title>Government Helpdesk</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <style>
    #pagetitle {
        background-color: black;
        color: greenyellow;
        text-align: center;
        border-radius: 100px;
        position: relative; 
    }

    #homeButton {
        font-size:25px;
        color:greenyellow;
        background-color: transparent;
        border: none;
        position: absolute;
        left: 15px;
        top: 50%;
        transform: translateY(-50%);
        cursor: pointer;
    }

    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
    }

    #findingMR, #findingMRProof, #generatingVP, #output, #divCrypto , #CID_Info{
        padding: 10px 100px 20px 100px;
        background-image: linear-gradient(to bottom right, rgb(250, 201, 234), rgb(164, 248, 237));
        border-radius: 25px;
        color: blue;
        margin-top: 15px;
        align-items: center;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    #MR_compute, #MR_proof_compute, #creating_VP, #cidInfo{
        color: rebeccapurple;
        /* background: rgb(243, 238, 240); */
        display: inline-flex;
        border-radius: 10px;
    }

    #merkleRootOutput, #merkleProofOutput{
        padding: 10px;
        color: red;
        font-weight: bold;
    }

    #verifyVacc {    
        padding: 10px 100px 100px 100px;
        background-color: cornsilk;
        text-align: center;
        border-radius: 25px;
        color: blue;    
    }

    #Verify_title {
        color: rebeccapurple;
        background: rgb(235, 219, 190);
        display: inline-flex;
        border-radius: 10px;
    }

    #calculatedRoot{
        padding: 10px;
        color: green;
        font-weight: bold;
    }

    #verification{
        padding: 10px;
        font-size: 50px;
        font-weight: bold;
    }

    /* Style all textboxes */
    input[type="text"]{
      width: 350px;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      color: black;
    }

    input[type="password"]{
        width: 350px;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 14px;
        color: black;
    }

    select{
        width: 350px;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 14px;
        color: black;
    }

    input[readonly] {
        background-color: #84898ae1;
        color: #1a0202;
    }

    form{
      margin-top: 20px;
    }

    table{
      margin-bottom: 10px;
    }

    td{
      padding: 5px;
      font-weight: bold;
    }

    ::placeholder {
      color: #999; 
      opacity: 0.5;
      font-size: small;
    }

    #cryptoInfo {
      width: 80%;
      border-collapse: collapse;
      margin: 0 auto; /* Center the table horizontally */
      margin-bottom: 30px;
    }

    #cryptoInfo td {
      padding: 8px;
      border: 2px solid rgb(22, 20, 20);
      word-wrap: break-word;
    }

    /* #CID_Info {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
    } */

    #CID_Info p {
      margin-top: 30px; /* Adjust the margin as needed */
    }

  /* #okButtonContainer {
    text-align: center;
    margin-top: 20px;
  } */

  #okButton {
    font-size: 16px;
    color: #ffffff;
    background-color: #1d0dfa;
    border: none;
    cursor: pointer;
  }

  #okButton i {
    margin-right: 5px;
  }

  /* #okButtonContainer span {
    position: absolute;
    bottom: -20px;
    left: 50%;
    transform: translateX(-50%);
    color:  #1d0dfa;
  } */

    /* CSS style for multi-row cells */
    .multirow {
      white-space: pre-wrap; /* Preserve line breaks */
    }

    label{
      font-weight: bold;
    }
    /* Style all buttons */
    button,
    input[type="button"],
    input[type="submit"] {
      background-color: #4CAF50;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      padding: 8px 16px;
    }

    /* Style hover and focus states */
    button:hover,
    input[type="button"]:hover,
    input[type="submit"]:hover,
    /* textarea:hover, */
    button:focus,
    input[type="button"]:focus,
    input[type="submit"]:focus
    {
      outline: none;
      background-color: #3e8e41;
    }

    input[type="reset"] {
      background-color: red;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      padding: 8px 16px;
    }
    input[type="reset"]:hover {
      outline: none;
      background-color: rgb(134, 25, 25)
    }

    .errorMessage{
      color: red;
      font-weight: bold;
    }

    #jsonOutput {
      display: block;
      margin: 0 auto;
      color: black;
      width: 70%;
      font-weight: bold;
    }

    textarea:hover {
      background-color: white; 
      cursor: initial; 
    }

    footer {
      display: flex;
      justify-content: center;
      align-items: center;
      position: fixed;
      bottom: 0;
      width: 100%;
      text-align: center;
      background-color: #f1f1f1;
      padding: 5px 0;
    }

    .footer-content {
      display: flex;
      justify-content: flex-start;
      align-items: center;
      width: 100%;
      max-width: 960px;
      margin: 0 auto;
    }
    
    .footer-content p {
      color: #888;
      font-size: 14px;
      margin: 0;
      flex-grow: 1;
      text-align: center;
    }

    #spinner {
      display: none;
      position: absolute;
      top: calc(100% + 10px);
      left: 50%;
      transform: translateX(-50%);
      width: 50px;
      height: 50px;
      border: 5px solid #f3f3f3;
      border-top: 5px solid #3498db;
      border-radius: 50%;
      animation: spin 1s infinite linear;
    }

    @keyframes spin {
      0% {
        transform: translateX(-50%) rotate(0deg);
      }
      100% {
        transform: translateX(-50%) rotate(360deg);
      }
    }

  </style>
</head>
<body>
  <center>
    <div id="pagetitle">
      <i class="glyphicon glyphicon-home" id="homeButton"></i>
      <h1>Government Helpdesk</h1>
    </div>

    <div id="selectFunction">
      <table>
        <tr>
          <td style="font-weight: bold; color: red;">Select Function: </td>
          <td>
            <label for="computeMerkleTreeRoot">Compute Merkle Tree Root for Vaccine ID Set</label>
            <input type="radio" name="functionSelector" id="computeMerkleTreeRoot" value="computeMerkleTreeRoot">
          </td>
          <td>
            <label for="computeMerkleTreeProof">Generate Commitment and Merkle Tree Proof for Vial ID</label>
            <input type="radio" name="functionSelector" id="computeMerkleTreeProof" value="computeMerkleTreeProof">
          </td>
          <td>
            <label for="createVP">Create Citizen's Vaccine Passport</label>
            <input type="radio" name="functionSelector" id="createVP" value="createVP">
          </td>
        </tr>
      </table>
    </div>
  
    <div id="findingMR" class="div1" style="display: none">
      <h2 id="MR_compute">Computation of Vaccine Stock MR Code </h2> <br><br>
      <form id="form_MR_compute" onsubmit="submitForm_MR(event)">
        <label for="dataInput">Enter values of vial ID set (comma separated): </label>
        <input type="text" id="dataInput" style="font-weight: bold;" required/>
        <button type="submit">Compute Hash</button>
      </form>
      <br><br>
      <div id="merkleRootOutput"></div>
    </div>
  
    <div id="findingMRProof" class="div2" style="display: none">
      <h2 id="MR_proof_compute">Computation of Commitment and Merkle Tree Proof for a Data Element</h2>
      <form id="form_MR_proof_compute" onsubmit="submitForm_MR_proof(event)">
        <center>
        <table>
          <tr>
            <td><label for="vialsID">Enter values of vial ID set (comma separated): </label></td>
            <td><input type="text" id="vialsID" required/></td>
          </tr>
          <tr>
            <td><label for="element">Enter value of vial ID to be injected to citizen: </label></td>
            <td><input type="text" id="element" required></td>
          </tr>
        </table>
        </center>
        <br>
        <table>
          <tr>
            <td><button type="submit">Compute Merkle Tree Proof</button></td>
            <td><input type="reset"></td>
          </tr>
        </table>
      </form>
      <br><br>
      <div id="merkleProofOutput"></div>
      <br>
    </div>

    <div id="generatingVP" class="div3" style="display: none">
      <h2 id="creating_VP">Creation of Citizen's Vaccine Passport</h2>
      <form id="vpForm">
        <table>
            <tr>
                <td><label for="citizenAddr">Citizen's Ethereum Wallet Address:</label></td>
                <td><input type="text" id="citizenAddr" name="citizenAddr" placeholder="Hexadecimal string of 42 chars, prefix with '0x'" required></td>
                <td><span id="error_citizenAddr"></span></td>
            </tr>
            <tr>
                <td><label for="hashOfCitizenInfo">Hash of Citizen's Personal Information:</label></td>
                <td><input type="text" id="hashOfCitizenInfo" name="hashOfCitizenInfo" placeholder="Solidity SHA3 256 bit hash value, prefix with '0x'" required></td>
                <td><span id="error_hashOfCitizenInfo"></span></td>	
            </tr>
            <tr>
                <td><label for="targatedDisease">Targated Disease:</label></td>
                <td><input type="text" id="targatedDisease" value="COVID 19" readonly></td>
                <td><span id="error_targatedDisease"></span></td>
            </tr>
            <tr>
                <td><label for="countryOfVaccination">Country of Vaccination:</label></td>
                <td>
                  <select id="countryOfVaccination">
                    <option value="Afghanistan">Afghanistan</option>
                    <option value="Albania">Albania</option>
                    <option value="Algeria">Algeria</option>
                    <option value="Andorra">Andorra</option>
                    <option value="Angola">Angola</option>
                    <option value="Antigua and Barbuda">Antigua and Barbuda</option>
                    <option value="Argentina">Argentina</option>
                    <option value="Armenia">Armenia</option>
                    <option value="Australia">Australia</option>
                    <option value="Austria">Austria</option>
                    <option value="Azerbaijan">Azerbaijan</option>
                    <option value="Bahamas">Bahamas</option>
                    <option value="Bahrain">Bahrain</option>
                    <option value="Bangladesh">Bangladesh</option>
                    <option value="Barbados">Barbados</option>
                    <option value="Belarus">Belarus</option>
                    <option value="Belgium">Belgium</option>
                    <option value="Belize">Belize</option>
                    <option value="Benin">Benin</option>
                    <option value="Bhutan">Bhutan</option>
                    <option value="Bolivia">Bolivia</option>
                    <option value="Bosnia and Herzegovina">Bosnia and Herzegovina</option>
                    <option value="Botswana">Botswana</option>
                    <option value="Brazil">Brazil</option>
                    <option value="Brunei">Brunei</option>
                    <option value="Bulgaria">Bulgaria</option>
                    <option value="Burkina Faso">Burkina Faso</option>
                    <option value="Burundi">Burundi</option>
                    <option value="Côte d'Ivoire">Côte d'Ivoire</option>
                    <option value="Cabo Verde">Cabo Verde</option>
                    <option value="Cambodia">Cambodia</option>
                    <option value="Cameroon">Cameroon</option>
                    <option value="Canada">Canada</option>
                    <option value="Central African Republic">Central African Republic</option>
                    <option value="Chad">Chad</option>
                    <option value="Chile">Chile</option>
                    <option value="China">China</option>
                    <option value="Colombia">Colombia</option>
                    <option value="Comoros">Comoros</option>
                    <option value="Congo (Congo-Brazzaville)">Congo (Congo-Brazzaville)</option>
                    <option value="Costa Rica">Costa Rica</option>
                    <option value="Croatia">Croatia</option>
                    <option value="Cuba">Cuba</option>
                    <option value="Cyprus">Cyprus</option>
                    <option value="Czechia (Czech Republic)">Czechia (Czech Republic)</option>
                    <option value="Democratic Republic of the Congo">Democratic Republic of the Congo</option>
                    <option value="Denmark">Denmark</option>
                    <option value="Djibouti">Djibouti</option>
                    <option value="Dominica">Dominica</option>
                    <option value="Dominican Republic">Dominican Republic</option>
                    <option value="Ecuador">Ecuador</option>
                    <option value="Egypt">Egypt</option>
                    <option value="El Salvador">El Salvador</option>
                    <option value="Equatorial Guinea">Equatorial Guinea</option>
                    <option value="Eritrea">Eritrea</option>
                    <option value="Estonia">Estonia</option>
                    <option value="Eswatini">Eswatini</option>
                    <option value="Ethiopia">Ethiopia</option>
                    <option value="Fiji">Fiji</option>
                    <option value="Finland">Finland</option>
                    <option value="France">France</option>
                    <option value="Gabon">Gabon</option>
                    <option value="Gambia">Gambia</option>
                    <option value="Georgia">Georgia</option>
                    <option value="Germany">Germany</option>
                    <option value="Ghana">Ghana</option>
                    <option value="Greece">Greece</option>
                    <option value="Grenada">Grenada</option>
                    <option value="Guatemala">Guatemala</option>
                    <option value="Guinea">Guinea</option>
                    <option value="Guinea-Bissau">Guinea-Bissau</option>
                    <option value="Guyana">Guyana</option>
                    <option value="Haiti">Haiti</option>
                    <option value="Holy See">Holy See</option>
                    <option value="Honduras">Honduras</option>
                    <option value="Hungary">Hungary</option>
                    <option value="Iceland">Iceland</option>
                    <option value="India" selected>India</option>
                    <option value="Indonesia">Indonesia</option>
                    <option value="Iran">Iran</option>
                    <option value="Iraq">Iraq</option>
                    <option value="Ireland">Ireland</option>
                    <option value="Israel">Israel</option>
                    <option value="Italy">Italy</option>
                    <option value="Jamaica">Jamaica</option>
                    <option value="Japan">Japan</option>
                    <option value="Jordan">Jordan</option>
                    <option value="Kazakhstan">Kazakhstan</option>
                    <option value="Kenya">Kenya</option>
                    <option value="Kiribati">Kiribati</option>
                    <option value="Kuwait">Kuwait</option>
                    <option value="Kyrgyzstan">Kyrgyzstan</option>
                    <option value="Laos">Laos</option>
                    <option value="Latvia">Latvia</option>
                    <option value="Lebanon">Lebanon</option>
                    <option value="Lesotho">Lesotho</option>
                    <option value="Liberia">Liberia</option>
                    <option value="Libya">Libya</option>
                    <option value="Liechtenstein">Liechtenstein</option>
                    <option value="Lithuania">Lithuania</option>
                    <option value="Luxembourg">Luxembourg</option>
                    <option value="Madagascar">Madagascar</option>
                    <option value="Malawi">Malawi</option>
                    <option value="Malaysia">Malaysia</option>
                    <option value="Maldives">Maldives</option>
                    <option value="Mali">Mali</option>
                    <option value="Malta">Malta</option>
                    <option value="Marshall Islands">Marshall Islands</option>
                    <option value="Mauritania">Mauritania</option>
                    <option value="Mauritius">Mauritius</option>
                    <option value="Mexico">Mexico</option>
                    <option value="Micronesia">Micronesia</option>
                    <option value="Moldova">Moldova</option>
                    <option value="Monaco">Monaco</option>
                    <option value="Mongolia">Mongolia</option>
                    <option value="Montenegro">Montenegro</option>
                    <option value="Morocco">Morocco</option>
                    <option value="Mozambique">Mozambique</option>
                    <option value="Myanmar (formerly Burma)">Myanmar (formerly Burma)</option>
                    <option value="Namibia">Namibia</option>
                    <option value="Nauru">Nauru</option>
                    <option value="Nepal">Nepal</option>
                    <option value="Netherlands">Netherlands</option>
                    <option value="New Zealand">New Zealand</option>
                    <option value="Nicaragua">Nicaragua</option>
                    <option value="Niger">Niger</option>
                    <option value="Nigeria">Nigeria</option>
                    <option value="North Korea">North Korea</option>
                    <option value="North Macedonia">North Macedonia</option>
                    <option value="Norway">Norway</option>
                    <option value="Oman">Oman</option>
                    <option value="Pakistan">Pakistan</option>
                    <option value="Palau">Palau</option>
                    <option value="Palestine State">Palestine State</option>
                    <option value="Panama">Panama</option>
                    <option value="Papua New Guinea">Papua New Guinea</option>
                    <option value="Paraguay">Paraguay</option>
                    <option value="Peru">Peru</option>
                    <option value="Philippines">Philippines</option>
                    <option value="Poland">Poland</option>
                    <option value="Portugal">Portugal</option>
                    <option value="Qatar">Qatar</option>
                    <option value="Romania">Romania</option>
                    <option value="Russia">Russia</option>
                    <option value="Rwanda">Rwanda</option>
                    <option value="Saint Kitts and Nevis">Saint Kitts and Nevis</option>
                    <option value="Saint Lucia">Saint Lucia</option>
                    <option value="Saint Vincent and the Grenadines">Saint Vincent and the Grenadines</option>
                    <option value="Samoa">Samoa</option>
                    <option value="San Marino">San Marino</option>
                    <option value="Sao Tome and Principe">Sao Tome and Principe</option>
                    <option value="Saudi Arabia">Saudi Arabia</option>
                    <option value="Senegal">Senegal</option>
                    <option value="Serbia">Serbia</option>
                    <option value="Seychelles">Seychelles</option>
                    <option value="Sierra Leone">Sierra Leone</option>
                    <option value="Singapore">Singapore</option>
                    <option value="Slovakia">Slovakia</option>
                    <option value="Slovenia">Slovenia</option>
                    <option value="Solomon Islands">Solomon Islands</option>
                    <option value="Somalia">Somalia</option>
                    <option value="South Africa">South Africa</option>
                    <option value="South Korea">South Korea</option>
                    <option value="South Sudan">South Sudan</option>
                    <option value="Spain">Spain</option>
                    <option value="Sri Lanka">Sri Lanka</option>
                    <option value="State of Palestine">State of Palestine</option>
                    <option value="Sudan">Sudan</option>
                    <option value="Suriname">Suriname</option>
                    <option value="Sweden">Sweden</option>
                    <option value="Switzerland">Switzerland</option>
                    <option value="Syria">Syria</option>
                    <option value="Tajikistan">Tajikistan</option>
                    <option value="Tanzania">Tanzania</option>
                    <option value="Thailand">Thailand</option>
                    <option value="Timor-Leste">Timor-Leste</option>
                    <option value="Togo">Togo</option>
                    <option value="Tonga">Tonga</option>
                    <option value="Trinidad and Tobago">Trinidad and Tobago</option>
                    <option value="Tunisia">Tunisia</option>
                    <option value="Turkey">Turkey</option>
                    <option value="Turkmenistan">Turkmenistan</option>
                    <option value="Tuvalu">Tuvalu</option>
                    <option value="Uganda">Uganda</option>
                    <option value="Ukraine">Ukraine</option>
                    <option value="United Arab Emirates">United Arab Emirates</option>
                    <option value="United Kingdom">United Kingdom</option>
                    <option value="United States of America">United States of America</option>
                    <option value="Uruguay">Uruguay</option>
                    <option value="Uzbekistan">Uzbekistan</option>
                    <option value="Vanuatu">Vanuatu</option>
                    <option value="Venezuela">Venezuela</option>
                    <option value="Vietnam">Vietnam</option>
                    <option value="Yemen">Yemen</option>
                    <option value="Zambia">Zambia</option>
                    <option value="Zimbabwe">Zimbabwe</option>
                  </select>
                </td>
                <td><span id="error_countryOfVaccination"></span></td>
            </tr>                  
            <tr>
                <td><label for="timestampOfVPGeneration">Timestamp of Generating Vaccine Passport:</label></td>
                <td><input type="text" id="timestampOfVPGeneration" readonly></td>
                <td><span id="error_timestampOfVPGeneration"></span></td>
            </tr>
            <tr>
                <td><label for="issuerVaccinationCenterAddr">Vaccination Center's Ethereum Wallet Address:</label></td>
                <td><input type="text" id="issuerVaccinationCenterAddr" placeholder="Hexadecimal string of 42 chars, prefix with '0x'" required></td>
                <td><span id="error_issuerVaccinationCenterAddr"></span></td>
            </tr>
            <tr>
                <td><label for="issuerVaccinationCenterID">Vaccination Center ID:</label></td>
                <td><input type="text" id="issuerVaccinationCenterID" placeholder="Integer Value" required></td>
                <td><span id="error_issuerVaccinationCenterID"></span></td>
            </tr>
            <tr>
                <td><label for="vaccineName">Vaccine Name:</label></td>
                <td>
                  <select id="vaccineName">
                    <option value="Covishield" selected>Covishield</option>
                    <option value="Covaxin">Covaxin</option>
                    <option value="Sputnik V">Sputnik V</option>
                    <option value="Moderna">Moderna</option>
                  </select>
                </td>
                <td><span id="error_vaccineName"></span></td>
            </tr>
            <tr>
                <td><label for="vaccineVialID">Vaccine Vial ID:</label></td>
                <td><input type="text" id="vaccineVialID" placeholder="Alphanumeric String" required></td>
                <td><span id="error_vaccineVialID"></span></td>
            </tr>
            <tr>
                <td><label for="stockID">Stock ID:</label></td>
                <td><input type="text" id="stockID" placeholder="Integer Value" required></td>
                <td><span id="error_stockID"></span></td>
            </tr>                
        </table>
        <br>
        <table>
          <tr>
            <td><button type="submit">Generate VP</button></td>
            <td><button type="submit" style="background-color: red;" onmouseover="this.style.backgroundColor='rgb(134, 25, 25)';" onmouseout="this.style.backgroundColor='red';" onclick="resetForm()">Reset</button></td>
          </tr>
        </table>
      </form>
    </div>
    <div id="output" style="display: none;">
        <h4>Generated Vaccine Passport (VP) Information</h4>
        <table>
          <tr>
            <td style="position: relative;">
              <textarea id="jsonOutput" rows="11" cols="115" style="color: black;" readonly></textarea>
              <span id="isVerifiedInfo" style="display: none; position: absolute; top: 50%; transform: translateY(-50%); left: calc(85% );">
                <i class="glyphicon glyphicon-ok" id="tickMark"></i>
                <strong>Information Verified!!</strong>
              </span>
            </td>
          </tr>
        </table>
        <table id="decideOnVP">
            <tr>
                <td><button type="submit" onclick="proceed()">Agree And Proceed</button></td>
                <td><button type="reset" style="background-color: red;" onmouseover="this.style.backgroundColor='rgb(134, 25, 25)';" onmouseout="this.style.backgroundColor='red';" onclick="goBack()">Disagree And Back</button></td>
            </tr>
        </table>
    </div>
    <div id="divCrypto" style="display: none;">
        <h4>Computing Cryptographic Parameters and Uploading VP to IPFS</h4>
        <form id="computeCryptoForm" >
            <table>
                <tr>
                    <td><label for="privateKeyGovt">Vaccine Passport Issuer's (i.e. Government) Private Key:</label></td>
                    <td><input type="password" id="privateKeyGovt" placeholder="Private Key of Government" required></td>
                    <td><span class="errorMessage" id="error_privateKeyGovt"></span></td>
                </tr>
                <tr>
                    <td><label for="publicKeyC">Citizen's Public Key:</label></td>
                    <td><input type="text" id="publicKeyC" placeholder="Public Key of Citizen" required></td>
                    <td><span class="errorMessage" id="error_publicKeyC"></span></td>
                </tr>
            </table>
            <br>
            <table id="computationOfCrypto">
                <tr>
                    <td><button type="submit">Compute</button></td>
                    <td><button type="reset" style="background-color: red;" onmouseover="this.style.backgroundColor='rgb(134, 25, 25)';" onmouseout="this.style.backgroundColor='red';">Reset</button></td>
                    <td><button type="submit" onclick="returnBack()">Back</button></td>
                </tr>
            </table>
        </form>
        <br><br>
        <div id="spinner" style="margin-top: 70px;"></div>
    </div>
    <div id="CID_Info" style="display: none;">
      <h2 id="cidInfo">Success!! Citizen's Vaccine Passport has been encrypted and uploaded to IPFS</h2><br>
        <h5 style="color: red; font-weight: bold;">Please note the following information</h5>
        <center>
          <table id="cryptoInfo">
            <tr>
              <td>Digital Fingerprint(Hash) of the Vaccine Passport</td>
              <td id="hash_of_VaccinePassport" style="color: black;"></td>
            </tr>
            <tr>
              <td>Digital Signature of the Issuer Vaccination Center on the Hash of the Vaccine Passport</td>
              <td id="digitalSignOfVC" style="color: black;"></td>
            </tr>
            <tr>
              <td>Content Identifier(CID) of the Encrypted Vaccine Passport</td>
              <td id="cidOfEncryptedVP" style="color: black;"></td>
            </tr>
          </table>
        </center>
        <button id="okButton">
          <i class="glyphicon glyphicon-ok"></i><span>Noted</span>
        </button>           
        <br><br>
        <P style="color: red;background-color: black; width: 100%; font-size: small;">Attention: To decrypt the encrypted vaccine passport, it is necessary to obtain consent from the citizen and subsequently utilize the Proxy Re-encryption Scheme for further processing.</P>
    </div>

    <footer>
      <div class="footer-content">
        <p>
          &copy; 2023 Vaccine Passport System. All rights reserved. Created by Debendranath Das, Indian Statistical Institute, Kolkata.
        </p>
      </div>
    </footer>
  <script>
    let vaccinePassport;

    const textBox1_findingMR_Form = document.getElementById("dataInput");
    textBox1_findingMR_Form.addEventListener("input", () => {
      document.getElementById("merkleRootOutput").innerText = "";
    });

    const textBox1_findingMRProof_Form = document.getElementById("vialsID");
    const textBox2_findingMRProof_Form = document.getElementById("element");
    textBox1_findingMRProof_Form.addEventListener("input", () => {
      document.getElementById("merkleProofOutput").innerText = "";
    });
    textBox2_findingMRProof_Form.addEventListener("input", () => {
      document.getElementById("merkleProofOutput").innerText = "";
    });

    const radioButtons = document.getElementsByName("functionSelector");
    radioButtons[0].addEventListener("change", () => {
      document.getElementById("findingMR").style.display = "block";
      document.getElementById("findingMRProof").style.display = "none";
      document.getElementById("generatingVP").style.display = "none";
      document.getElementById("output").style.display = "none";
      document.getElementById("divCrypto").style.display = "none";
      document.getElementById("vialsID").value = "";
      document.getElementById("element").value = "";
      document.getElementById("merkleProofOutput").innerText = "";
      document.getElementById("dataInput").value = "";
      document.getElementById("merkleRootOutput").innerText = ""; 
    });
    radioButtons[1].addEventListener("change", () => {
      document.getElementById("findingMRProof").style.display = "block";
      document.getElementById("findingMR").style.display = "none";
      document.getElementById("generatingVP").style.display = "none";
      document.getElementById("output").style.display = "none";
      document.getElementById("divCrypto").style.display = "none";
      document.getElementById("vialsID").value = "";
      document.getElementById("element").value = "";
      document.getElementById("merkleProofOutput").innerText = "";
      document.getElementById("dataInput").value = "";
      document.getElementById("merkleRootOutput").innerText = "";
    });
    radioButtons[2].addEventListener("change", () => {
      document.getElementById("generatingVP").style.display = "block";
      document.getElementById("findingMRProof").style.display = "none";
      document.getElementById("findingMR").style.display = "none";
      document.getElementById("output").style.display = "none";
      document.getElementById("divCrypto").style.display = "none";
      document.getElementById("vialsID").value = "";
      document.getElementById("element").value = "";
      document.getElementById("merkleProofOutput").innerText = "";
      document.getElementById("dataInput").value = "";
      document.getElementById("merkleRootOutput").innerText = "";
      document.getElementById("vpForm").reset();
      fetchCurrentTimestamp();
    });

    // JavaScript code to handle the form submission and display the response JSON
    async function submitForm_MR(event) {
      event.preventDefault(); // Prevent form submission and page reload

      const vialsID = document.getElementById('dataInput').value;

      const formData = {
        dataInput: vialsID
      };

      // Make an HTTP request to the server
      const response = await fetch('/compute_MR', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(formData)
      });

      const data = await response.json();
      console.log(data);
      document.getElementById("merkleRootOutput").innerHTML = `<span style="color: black; font-weight: bold">Merkle Tree Root Hash:</span> <br> 0x${data.rootHash}`;  
    } 

    async function submitForm_MR_proof(event) {
      event.preventDefault(); // Prevent form submission and page reload

      const vialsID = document.getElementById("vialsID").value.split(',').map(x => x.trim());
      const element = document.getElementById("element").value.trim();

      if (!vialsID.includes(element)) {
        alert("The given element is not found!!");
        return;
      }
      const formData = {
        vialsID: vialsID,
        element: element
      };

      // Make an HTTP request to the server
      const response = await fetch('/compute_MR_Proof', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(formData)
      });

      const data = await response.json();
      console.log(data);

      // Debugging
      console.log(data.proof); // Check the structure of the 'data.proofs' object
      const n = data.proof.length;
      let proofString = "";
      for(i=0;i<n-1;i++)
      {
        proofString += data.proof[i]+",<br>";
      }
      proofString += data.proof[n-1];
      //console.log(proofString);
      // Update the HTML content based on the response
      //document.getElementById("merkleProofOutput").innerHTML = `Merkle Root: 0x${data.rootHash} <br><br> Merkle Proof for ${element}:<br> ${proofString}`;
      document.getElementById("merkleProofOutput").innerHTML = `<span style="color: black;font-weight: bold">Commitment of Vial ID - ${element}:</span><br> ${data.vialCommitment} <br><br> <span style="color: black;font-weight: bold">Merkle Tree Root Hash:</span><br> 0x${data.rootHash} <br><br> <span style="color: black; font-weight: bold">Merkle Proof for ${element}:</span><br> ${proofString} <br><br> <span style="color: black; font-weight: bold">Commitment of Merkle Proof:</span> <br> ${data.mrProofCommitment}`;
 
    }

    /**JS Code for Generating VP**/
   
    function returnBack()
    {
        document.getElementById("decideOnVP").style.display = "block";
        document.getElementById("divCrypto").style.display = "none";
        document.getElementById("isVerifiedInfo").style.display = "none";
    }
    function proceed()
    {
        document.getElementById("decideOnVP").style.display = "none";
        document.getElementById("divCrypto").style.display = "block";
        document.getElementById("isVerifiedInfo").style.display = "block";
        document.getElementById("computeCryptoForm").reset();
    }
    function goBack()
    {    
        document.getElementById("vpForm").style.display = "block";
        document.getElementById("output").style.display = "none";
        radioButtons[0].disabled = false;
        radioButtons[1].disabled = false;
    }
    function fetchCurrentTimestamp()
    {
        var now = new Date();
        var day = now.getDate().toString().padStart(2, '0');
        var month = (now.getMonth() + 1).toString().padStart(2, '0');
        var year = now.getFullYear().toString();
        var hours = now.getHours().toString().padStart(2, '0');
        var minutes = now.getMinutes().toString().padStart(2, '0');
        var seconds = now.getSeconds().toString().padStart(2, '0');
        var formattedDateTime = day + '.' + month + '.' + year + ' ' + hours + ':' + minutes + ':' + seconds;
        document.getElementById("timestampOfVPGeneration").value = formattedDateTime;
      }
      //window.onload = fetchCurrentTimestamp;

    function resetForm()
    {
        //document.getElementById("jsonOutput").innerHTML = "";
        document.getElementById("error_citizenAddr").innerHTML = "";
        document.getElementById("error_hashOfCitizenInfo").innerHTML = "";
        document.getElementById("error_issuerVaccinationCenterAddr").innerHTML = "";
        document.getElementById("error_issuerVaccinationCenterID").innerHTML = "";
        document.getElementById("error_vaccineVialID").innerHTML = "";
        document.getElementById("error_stockID").innerHTML = "";
        document.getElementById("vpForm").reset();
        fetchCurrentTimestamp();
    }
      
    function createJSON(citizenAddr,hashOfCitizenInfo,targatedDisease,countryOfVaccination,timestampOfVPGeneration,vaccinationCenterAddr,vaccinationCenterID,vaccineName,vaccineVialID,stockID, govtAddr)
    {
        // Create JSON object
        console.log(citizenAddr);
        vaccinePassport = 
        {
            "Citizen Ethereum Address": citizenAddr,
            "Hash of Citizen Personal Info": hashOfCitizenInfo,
            "Disease Targeted": targatedDisease,
            "Country of Vaccination": countryOfVaccination,
            "Timestamp of Vaccination": timestampOfVPGeneration,
            "Vaccination Center Ethereum Address": vaccinationCenterAddr,
            "Vaccination Center ID": vaccinationCenterID,
            "Vaccine Name": vaccineName,
            "Vaccine Vial ID": vaccineVialID,
            "Stock ID": stockID,
            "Vaccine Passport Issuer's (i.e. Govt) Ethereum Address": govtAddr
        };

        console.log(vaccinePassport);
        // Convert JSON object to string
        //var json = JSON.stringify(vaccinePassport);
        var json = '';

        for (var key in vaccinePassport) 
        {
            if (vaccinePassport.hasOwnProperty(key)) 
            {
                json += key + ': ' + vaccinePassport[key] + '\n';
            }
        }

        // Display JSON object on the page
        document.getElementById("jsonOutput").innerHTML = json;
    }

    const vpForm = document.getElementById("vpForm");

    vpForm.addEventListener("submit", function (event) {
            event.preventDefault();

            const citizenAddr = document.getElementById("citizenAddr");
            const hashOfCitizenInfo = document.getElementById("hashOfCitizenInfo");
            const targatedDisease = document.getElementById("targatedDisease");
            const countryOfVaccination = document.getElementById("countryOfVaccination");
            const timestampOfVPGeneration = document.getElementById("timestampOfVPGeneration");
            const issuerVaccinationCenterAddr = document.getElementById("issuerVaccinationCenterAddr");
            const issuerVaccinationCenterID = document.getElementById("issuerVaccinationCenterID");
            const vaccineName = document.getElementById("vaccineName");
            const vaccineVialID = document.getElementById("vaccineVialID");
            const stockID = document.getElementById("stockID");

            if(!validateAddr(citizenAddr.value.trim()))
            {
                document.getElementById("error_citizenAddr").innerHTML = "Invalid citizen address!! Please enter the valid address.";
                citizenAddr.classList.add("error");
            }
            else
            {
                document.getElementById("error_citizenAddr").innerHTML = "";
                citizenAddr.classList.remove("error");
            }

            if(!validateHashOfCitizenInfo(hashOfCitizenInfo.value.trim()))
            {
                document.getElementById("error_hashOfCitizenInfo").innerHTML = "Invalid hash value!! Please enter the valid hash value.";
                hashOfCitizenInfo.classList.add("error");
            }
            else
            {
                document.getElementById("error_hashOfCitizenInfo").innerHTML = "";
                hashOfCitizenInfo.classList.remove("error");
            }

            if(!validateAddr(issuerVaccinationCenterAddr.value.trim()))
            {
                document.getElementById("error_issuerVaccinationCenterAddr").innerHTML = "Invalid VC Address!! Please enter the valid VC address.";
                issuerVaccinationCenterAddr.classList.add("error");
            }
            else
            {
                document.getElementById("error_issuerVaccinationCenterAddr").innerHTML = "";
                issuerVaccinationCenterAddr.classList.remove("error");
            }

            if(!validateVaccinationCenterID(issuerVaccinationCenterAddr.value.trim(),issuerVaccinationCenterID.value.trim()))
            {
                document.getElementById("error_issuerVaccinationCenterID").innerHTML = "Invalid VC ID!! Please enter the valid VC ID.";
                issuerVaccinationCenterID.classList.add("error");
            }
            else
            {
                document.getElementById("error_issuerVaccinationCenterID").innerHTML = "";
                issuerVaccinationCenterID.classList.remove("error");
            }

            if(!validateVaccineVialID(vaccineVialID.value.trim()))
            {
                document.getElementById("error_vaccineVialID").innerHTML = "Invalid vaccine vial ID!! Please enter the valid vial ID.";
                vaccineVialID.classList.add("error");
            }
            else
            {
                document.getElementById("error_vaccineVialID").innerHTML = "";
                vaccineVialID.classList.remove("error");
            }

            if(!validateStockID(stockID.value.trim()))
            {
                document.getElementById("error_stockID").innerHTML = "Invalid stock ID!! Please enter the valid stock ID.";
                stockID.classList.add("error");
            }
            else
            {
                document.getElementById("error_stockID").innerHTML = "";
                stockID.classList.remove("error");
            }

            // Submit the form if all fields are valid
            if (!citizenAddr.classList.contains("error") && !hashOfCitizenInfo.classList.contains("error") && !issuerVaccinationCenterAddr.classList.contains("error") && !issuerVaccinationCenterID.classList.contains("error") && !vaccineVialID.classList.contains("error") && !stockID.classList.contains("error")) 
            {
                document.getElementById("vpForm").style.display = "none";
                document.getElementById("output").style.display = "block";
                document.getElementById("decideOnVP").style.display = "block";
                document.getElementById("isVerifiedInfo").style.display = "none";
                radioButtons[0].disabled = true;
                radioButtons[1].disabled = true;
                createJSON(citizenAddr.value.trim(),hashOfCitizenInfo.value.trim(),targatedDisease.value,countryOfVaccination.value,timestampOfVPGeneration.value,issuerVaccinationCenterAddr.value.trim(),issuerVaccinationCenterID.value.trim().replace(/^0+/, ''),vaccineName.value,vaccineVialID.value.trim(),stockID.value.trim().replace(/^0+/, ''),"0x4d77E8A6D235d540Eb5cE251f5455F2e6A100287");
            }
        });

    function clearError()
    {
      document.getElementById("error_privateKeyGovt").innerHTML = "";
      document.getElementById("error_publicKeyC").innerHTML = "";
      document.getElementById("privateKeyGovt").classList.remove("error");
      document.getElementById("publicKeyC").classList.remove("error");
    }
    document.getElementById("privateKeyGovt").addEventListener("input", () => {
      clearError();
    });
    document.getElementById("publicKeyC").addEventListener("input", () => {
      clearError();
    });

    // Get a reference to the spinner element
    const spinner = document.getElementById('spinner');

    // Function to show the spinner
    function showSpinner() 
    {
      spinner.style.display = 'block';
      document.getElementById("computationOfCrypto").style.display = 'none';
    }

    // Function to hide the spinner
    function hideSpinner() 
    {
      spinner.style.display = 'none';
      document.getElementById("computationOfCrypto").style.display = 'block';
    }

    const computeCryptoForm = document.getElementById("computeCryptoForm");

    computeCryptoForm.addEventListener("submit", async function(event){
      event.preventDefault();
      //console.log("inside crypto compute");
      //console.log(vaccinePassport);
      const privateKeyGovt = document.getElementById("privateKeyGovt");
      const publicKeyC = document.getElementById("publicKeyC");

      privateKeyRegex = /^(0x)?([0-9a-f]{64})$/i;
      publicKeyRegex = /^(0x)?(04)?([0-9a-f]{128})$/i;
      
      if(!privateKeyRegex.test(privateKeyGovt.value.trim()))
      {
        document.getElementById("error_privateKeyGovt").innerHTML = "Invalid Private Key!! Please enter the valid private key.";
        privateKeyGovt.classList.add("error");
      }

      if(!publicKeyRegex.test(publicKeyC.value.trim()))
      {
        document.getElementById("error_publicKeyC").innerHTML = "Invalid Public Key!! Please enter the valid public key.";
        publicKeyC.classList.add("error");
      }
      
      //If no errors, then reach to server..
      if( !privateKeyGovt.classList.contains("error") && !publicKeyC.classList.contains("error") )
      {
        showSpinner();
        const formData = {
          "Vaccine_Passport": vaccinePassport,    
          "Private_Key_Govt": privateKeyGovt.value,
          "Public_Key_C": publicKeyC.value
        };
        //console.log(formData["Vaccine Passport"]["Citizen Ethereum Address"]);
        // Make an HTTP request to the server
        const response = await fetch('/compute_crypto', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(formData)
        });

        const data = await response.json();
        hideSpinner();
        //console.log(data);
        let flag = true;
        //console.log(data['errorMessage_Govt']);
        //console.log(data['errorMessage_C']);
        if(data['errorMessage_Govt'] != "")
        {
          document.getElementById("error_privateKeyGovt").innerHTML = data['errorMessage_Govt'];
          flag = false;
        }
        if(data['errorMessage_C'] != "")
        {
          document.getElementById("error_publicKeyC").innerHTML = data['errorMessage_C'];
          flag = false;
        }
        if(flag)
        {
          //display hash of VP, Sign of VC on VP hash and CID..
          console.log(data); 
          document.getElementById("output").style.display = "none";
          document.getElementById("divCrypto").style.display = "none";
          document.getElementById("CID_Info").style.display = "block";
          document.getElementById("generatingVP").style.display = "none";

          document.getElementById("hash_of_VaccinePassport").innerHTML = data.hash_of_VP;
          document.getElementById("digitalSignOfVC").innerHTML = data.sign_of_VC_on_hash_VP;
          document.getElementById("cidOfEncryptedVP").innerHTML = data.cid;
        }
      }
      
    });

    function validateAddr(_address)
    {
        var isValid = true;
        var regx = /^0[x,X][\d,a-f,A-F]{40}$/;
        if(!regx.test(_address))
        {
            isValid = false;
        }
        return isValid;
    }

    function validateHashOfCitizenInfo(_hashVal)
    {
        var isValid = true;
        var regx = /^0[x,X][\d,a-f,A-F]{64}$/;
        if(!regx.test(_hashVal))
        {
            isValid = false;
        }
        return true;
    }

    function validateVaccinationCenterID(_vcAddr, _vcID)
    {
        return true;
    }

    function validateVaccineVialID(_vID)
    {
        return true;
    }

    function validateStockID(_stockID)
    {
        return true;
    }


    const homeBtn = document.getElementById("homeButton");
    homeBtn.addEventListener("click", () => {
      window.location.href = '/';
    });
    
    const okBtn = document.getElementById("okButton");
    okBtn.addEventListener("click", () => {
      radioButtons[0].disabled = false;
      radioButtons[1].disabled = false;
      document.getElementById("CID_Info").style.display = "none";
      document.getElementById("generatingVP").style.display = "block";
      document.getElementById("vpForm").reset();
      document.getElementById("vpForm").style.display = "block";
      fetchCurrentTimestamp();
    });
  </script>
  

</body>

</html>